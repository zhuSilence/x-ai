# Twitter API 频次限制配置说明

## 🔧 功能概述

Twitter爬虫已增强频次限制功能，确保每次API请求之间有适当的间隔，避免被Twitter API拦截。

## ⚙️ 频次限制设置

### 默认设置
- **默认间隔**: 1.0秒
- **最小建议**: 0.5秒（风险较高）
- **推荐设置**: 1.0-1.5秒（平衡速度和稳定性）
- **保守设置**: 2.0秒以上（最稳定，适合大批量爬取）

### 环境变量配置

#### 设置方法

**Mac/Linux:**
```bash
export TWITTER_RATE_DELAY=1.5
python twitter_scraper.py
```

**Windows:**
```cmd
set TWITTER_RATE_DELAY=1.5
python twitter_scraper.py
```

**临时设置（单次运行）:**
```bash
TWITTER_RATE_DELAY=2.0 python twitter_scraper.py
```

## 📊 频次控制机制

### 1. 双重保护
- **API请求前**: 每次调用API前强制等待
- **用户间隔**: 处理完一个用户后额外延迟

### 2. 智能等待
- **精确控制**: 基于上次请求时间计算精确等待时间
- **线程安全**: 多线程环境下的请求同步
- **实时反馈**: 显示等待时间和当前设置

### 3. 错误处理
- **限制检测**: 自动识别API限制错误
- **友好提示**: 详细的错误信息和建议
- **设置显示**: 出错时显示当前延迟设置

## 🎯 使用建议

### 根据使用场景调整

| 场景 | 建议设置 | 说明 |
|------|----------|------|
| 测试/少量用户 | 1.0秒 | 默认设置，快速测试 |
| 日常使用 | 1.5秒 | 推荐设置，稳定可靠 |
| 大批量爬取 | 2.0-3.0秒 | 保守设置，避免封禁 |
| 高频使用 | 2.5秒以上 | 最安全设置 |

### 监控和调整

1. **观察日志输出**：
   - 🔍 查询用户信息
   - 📡 请求推文数据
   - ⏳ 频次限制等待
   - ⏱️ 用户间延迟

2. **遇到限制时**：
   - 增加 `TWITTER_RATE_DELAY` 值
   - 重新运行脚本
   - 考虑分批处理用户

3. **优化性能**：
   - 监控成功率
   - 调整到最佳平衡点
   - 避免过于保守的设置

## 🚨 注意事项

### API限制类型
- **请求频率限制**: 短时间内请求次数限制
- **日配额限制**: 每日总请求数限制
- **并发限制**: 同时进行的请求数限制

### 最佳实践
1. **从保守设置开始**: 首次使用建议设置2.0秒
2. **逐步优化**: 根据成功率逐步降低延迟
3. **监控反馈**: 关注错误日志和成功率
4. **分批处理**: 大量用户时考虑分批运行
5. **错峰使用**: 避开API使用高峰期

### 错误处理
如果仍然遇到频率限制错误：
1. 增加延迟时间到2-3秒
2. 检查Twitter API配额使用情况
3. 考虑使用Twitter API Pro或Enterprise版本
4. 联系Twitter开发者支持

## 📝 配置示例

```bash
# 快速测试（有风险）
export TWITTER_RATE_DELAY=0.5

# 标准使用（推荐）
export TWITTER_RATE_DELAY=1.5

# 保守设置（最稳定）
export TWITTER_RATE_DELAY=2.5
```

## 🔄 动态调整示例

```bash
# 开始时使用保守设置
export TWITTER_RATE_DELAY=2.0
python twitter_scraper.py

# 如果运行稳定，可以逐步降低
export TWITTER_RATE_DELAY=1.5
python twitter_scraper.py

# 如果出现限制，重新调高
export TWITTER_RATE_DELAY=2.5
python twitter_scraper.py
```